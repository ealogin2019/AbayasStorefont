generator client {
  provider      = "prisma-client-js"
  output        = "../generated/prisma"
  binaryTargets = ["native", "windows"]
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// Customer model for user accounts
model Customer {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  firstName String?
  lastName  String?
  phone     String?
  address   String?
  city      String?
  country   String?
  zipCode   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  carts  Cart[]
  orders Order[]

  @@index([email])
}

// Product model
model Product {
  id          String           @id @default(cuid())
  name        String           @unique
  description String
  price       Float
  currency    String           @default("AED")
  image       String
  thumbnail   String
  gallery     Json? // Array of image URLs
  colors      Json // Array of color options
  sizes       Json // Array of size options
  tags        Json? // Array of tags
  inStock     Boolean          @default(true)
  quantity    Int              @default(0)
  variants    ProductVariant[]
  category    String? // e.g., "signature", "premium", "seasonal"
  featured    Boolean          @default(false) // Show in featured collection
  bestSeller  Boolean          @default(false) // Show in best sellers
  newArrival  Boolean          @default(false) // Show in new arrivals
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt

  cartItems  CartItem[]
  orderItems OrderItem[]

  @@index([name])
  @@index([category])
  @@index([featured])
  @@index([bestSeller])
}

// Product variants: size/color/stock/price per variant
model ProductVariant {
  id        String  @id @default(cuid())
  productId String
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  size  String
  color String
  stock Int      @default(0)
  price Decimal?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  cartItems  CartItem[]
  orderItems OrderItem[]

  @@index([productId])
}

// Shopping cart
model Cart {
  id         String   @id @default(cuid())
  sessionId  String? // For guest carts
  customerId String? // For logged-in users
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  customer Customer?  @relation(fields: [customerId], references: [id], onDelete: Cascade)
  items    CartItem[]

  @@index([sessionId])
  @@index([customerId])
}

model CartItem {
  id        String   @id @default(cuid())
  cartId    String
  productId String
  variantId String?
  quantity  Int
  size      String?
  color     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  cart    Cart            @relation(fields: [cartId], references: [id], onDelete: Cascade)
  product Product         @relation(fields: [productId], references: [id])
  variant ProductVariant? @relation(fields: [variantId], references: [id])

  @@unique([cartId, productId, variantId])
  @@index([cartId])
  @@index([productId])
  @@index([variantId])
}

// Order model
model Order {
  id                String    @id @default(cuid())
  customerId        String?
  orderNumber       String    @unique
  status            String    @default("pending") // pending, processing, shipped, delivered, cancelled
  subtotal          Float
  tax               Float     @default(0)
  shippingCost      Float     @default(0)
  total             Float
  notes             String?
  trackingNumber    String?
  trackingUrl       String?
  estimatedDelivery DateTime?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  customer Customer?   @relation(fields: [customerId], references: [id], onDelete: SetNull)
  items    OrderItem[]

  @@index([customerId])
  @@index([orderNumber])
}

// Order items
model OrderItem {
  id        String  @id @default(cuid())
  orderId   String
  productId String
  variantId String?
  quantity  Int
  price     Float // Price at time of purchase
  size      String?
  color     String?

  order   Order           @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product Product         @relation(fields: [productId], references: [id])
  variant ProductVariant? @relation(fields: [variantId], references: [id])

  @@index([orderId])
  @@index([productId])
  @@index([variantId])
}

// Admin users for CMS
model Admin {
  id        String    @id @default(cuid())
  email     String    @unique
  password  String // Hashed with bcrypt
  firstName String?
  lastName  String?
  role      String    @default("editor") // admin, editor, manager
  active    Boolean   @default(true)
  lastLogin DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@index([email])
}

// Plugin configurations
model PluginConfig {
  id        String   @id @default(cuid())
  name      String   @unique
  enabled   Boolean  @default(true)
  settings  Json? // Stores plugin-specific settings
  version   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Simple key/value site settings for admin-managed configuration
model Setting {
  id          String   @id @default(cuid())
  key         String   @unique
  value       Json
  group       String? // e.g., "site", "checkout", "shipping"
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([key])
  @@index([group])
}

// Audit log for tracking admin actions
model AuditLog {
  id        String   @id @default(cuid())
  adminId   String?
  action    String // "create", "update", "delete"
  entity    String // "product", "order", "customer"
  entityId  String
  changes   Json? // Tracks what changed
  createdAt DateTime @default(now())

  @@index([adminId])
  @@index([entity])
  @@index([createdAt])
}

// Homepage content management
model HomepageContent {
  id        String   @id @default(cuid())
  section   String // "hero", "gallery", "banner"
  title     String?
  subtitle  String?
  image     String?
  link      String?
  order     Int      @default(0)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([section])
  @@index([isActive])
}
